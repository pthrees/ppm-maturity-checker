# アセスメント スコアリングロジック 調査レポート

## 概要

PPM Maturity Checker のスコアリングロジックは**すべてクライアントサイド**で計算されている。サーバーは回答データ（`answers` JSON）を保存・取得するのみで、スコア計算には関与しない。

## データ構造

### 入力（回答データ）

各質問に対して **2軸** で回答する：

| 軸                        | 値の範囲   | 意味                       |
| ------------------------- | ---------- | -------------------------- |
| **成熟度** (`maturity`)   | `0` 〜 `3` | その領域の現状の成熟レベル |
| **重要度** (`importance`) | `1` 〜 `3` | その領域の経営上の重要度   |

> [!NOTE]
> 成熟度は `0`（未実施）から始まるが、重要度は `1`（低）から始まる。

### カテゴリ構成

4カテゴリ × 各3問 = **計12問**

| Key   | カテゴリ名     | 質問例                                                        |
| ----- | -------------- | ------------------------------------------------------------- |
| **A** | 稼働管理       | A1:工数入力率, A2:予実一元把握, A3:PM負荷見える化             |
| **B** | スキル・配員   | B1:スキルアサイン, B2:炎上防止, B3:要件定義(型)化             |
| **C** | 収益性管理     | C1:見積り根拠標準化, C2:乖離要因特定, C3:撤退基準明確化       |
| **D** | プロセス成熟度 | D1:RAID管理標準化, D2:経営ダッシュボード, D3:リソース調整会議 |

定義ファイル: [questions.ts](file:///Users/tanakahiroshi/dev/ppm-maturity-checker/client/src/lib/questions.ts)

---

## スコアリングロジック

すべて [Result.tsx](file:///Users/tanakahiroshi/dev/ppm-maturity-checker/client/src/pages/Result.tsx) 内に実装。

### 1. リスクスコア計算

[calculateRisk](file:///Users/tanakahiroshi/dev/ppm-maturity-checker/client/src/pages/Result.tsx#L60-L62) 関数：

```typescript
function calculateRisk(maturity: number, importance: number) {
  return (3 - maturity) * importance;
}
```

| 意味             | 計算式                                    |
| ---------------- | ----------------------------------------- |
| **ギャップ**     | `3 - maturity`（理想値3との差）           |
| **リスクスコア** | `ギャップ × importance`                   |
| **最大値**       | `(3-0) × 3 = 9`（成熟度0, 重要度3のとき） |
| **最小値**       | `(3-3) × 1 = 0`（成熟度3, 重要度1のとき） |

### 2. カテゴリ集計

[analyzeAssessment](file:///Users/tanakahiroshi/dev/ppm-maturity-checker/client/src/pages/Result.tsx#L65-L134) 関数で、カテゴリごとに以下を集計：

- `riskSum` — 所属する質問のリスクスコア合計
- `maturitySum` / `importanceSum` — 平均計算用の合計
- `count` — 質問数（通常各3）

算出される値：

- **平均成熟度** = `maturitySum / count`
- **平均重要度** = `importanceSum / count`

### 3. 優先改善カテゴリの決定

`riskSum`（リスクスコア合計）が**最大**のカテゴリが優先改善対象となる。

**タイブレーカー（同点時のロジック）**：

```
1. riskSum が大きい方を優先
2. 同点 → 平均重要度が高い方を優先
3. それも同点 → 平均成熟度が低い方を優先
```

### 4. 判定ラベル（危険 / 注意 / 良好）

テーブル表示時に使用される判定ロジック：

```typescript
const riskLevel =
  avgMaturity < 1.5 && avgImportance > 2
    ? "危険"
    : avgMaturity < 2
      ? "注意"
      : "良好";
```

| 判定     | 条件                                         |
| -------- | -------------------------------------------- |
| **危険** | 平均成熟度 < 1.5 **かつ** 平均重要度 > 2.0   |
| **注意** | 平均成熟度 < 2.0（危険条件に該当しない場合） |
| **良好** | 平均成熟度 ≥ 2.0                             |

---

## 出力される結果

| 要素                 | 内容                                                       |
| -------------------- | ---------------------------------------------------------- |
| **レーダーチャート** | 4カテゴリの平均成熟度 vs 理想値(3.0)                       |
| **散布図**           | 各カテゴリの（平均成熟度, 平均重要度）をプロット           |
| **詳細テーブル**     | カテゴリ別の成熟度・重要度・リスクスコア・判定             |
| **Priority Action**  | 優先カテゴリに応じたフィードバックテキスト＋推奨アクション |
| **規模別コメント**   | 会社規模（localStorageから取得）に応じた落とし穴の指摘     |

---

## 補足事項

> [!IMPORTANT]
>
> - スコアリングロジックは**サーバーサイドに存在しない**。メール送信時のスコアデータもクライアント側で計算したものをリクエストボディとして送っている
> - 総合リスクレベル（ヘッダーの「要改善」）は**ハードコードされている**（[L386](file:///Users/tanakahiroshi/dev/ppm-maturity-checker/client/src/pages/Result.tsx#L386)）
> - 会社規模 (`sizeId`) は `localStorage` から取得されており、DBには保存されていない（`assessment_size_{id}` キー）
