# 結果画面 表示仕様

## 画面URL

`/result/:id` — アセスメントIDを指定して結果を表示

---

## 画面構成

結果画面は上から順に以下のセクションで構成される。

### 1. ヘッダー（固定）

| 要素   | 内容                                       |
| ------ | ------------------------------------------ |
| ロゴ   | P3 PPM Maturity Checker                    |
| ボタン | 「結果を転送」— メール送信ダイアログを開く |

---

### 2. ユーザー情報バー

| 要素             | 表示内容                                 | データソース                     |
| ---------------- | ---------------------------------------- | -------------------------------- |
| 氏名             | `{name}さん`（未入力時は「未入力さん」） | `assessment.userInfo.name`       |
| 診断日           | `診断日: YYYY/MM/DD`                     | `assessment.createdAt`           |
| 総合リスクレベル | 「要改善」                               | **ハードコード**（動的算出なし） |

---

### 3. Priority Action カード

優先改善カテゴリに基づくフィードバックを表示する。

#### 優先カテゴリの決定ロジック

1. カテゴリ別リスクスコア合計が最大のカテゴリを選択
2. 同点時：平均重要度が高い方 → さらに同点なら平均成熟度が低い方

#### カテゴリ別フィードバック内容

| カテゴリ             | タイトル                                 | 推奨アクション                                                                                         |
| -------------------- | ---------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| **A** 稼働管理       | 「稼働の見える化」が最優先課題です       | ①日次での工数入力を徹底する ②プロジェクト別の予実状況を週次で確認する会議を設ける                      |
| **B** スキル・配員   | 「リソース配分の最適化」が急務です       | ①主要メンバーのスキルマップを作成する ②要件定義や設計の標準ドキュメント（型）を整備する                |
| **C** 収益性管理     | 「収益管理の厳格化」が必要です           | ①見積もりの承認プロセスに基準を設ける ②赤字プロジェクトの撤退・縮小基準を明文化する                    |
| **D** プロセス成熟度 | 「組織プロセスの標準化」を目指しましょう | ①PMO（またはそれに準ずる機能）を立ち上げる ②全プロジェクトの状況を俯瞰する経営ダッシュボードを構築する |

#### 規模別「落とし穴」テキスト

従業員規模に応じた警告メッセージ（`localStorage` の `assessment_size_{id}` から取得）：

| 規模ID | 規模       | メッセージ                                                                                                                                     |
| ------ | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| S1     | 〜10名     | 属人化と兼務が前提になり、問題が見えないまま拡大しやすい傾向にあります。仕組み化が遅れるほど、後からの標準化コストが増えるため注意が必要です。 |
| S2     | 11〜30名   | 案件と人の増加で、PM/PLの"見えない負荷"が急増しやすい時期です。体制の当たり外れが収益性を左右しやすいのがこの規模の特徴です。                  |
| S3     | 31〜100名  | 部分最適が進み、全体の予実・稼働・品質がつながらなくなるフェーズです。炎上が"再現性をもって"起こり始めるため、組織的な対策が求められます。     |
| S4     | 101〜300名 | 標準化不足がボトルネックになり、管理が破綻しやすい規模です。撤退判断の遅れが不採算を固定化しやすいため、明確な基準運用が不可欠です。           |
| S5     | 301名以上  | 意思決定とガバナンスが重くなり、現場の改善が進みにくい状況に陥りがちです。全社最適のリソース調整が難しく、投資判断が遅れるリスクが高まります。 |

#### カテゴリ別の一行警告

| カテゴリ | テキスト                                                                   |
| -------- | -------------------------------------------------------------------------- |
| A        | 負荷が見えない状態が続くと、離職と炎上が同時進行しやすくなります。         |
| B        | ミスマッチは品質だけでなく、ブランド毀損として回収不能な損失になり得ます。 |
| C        | 不採算の"見逃し"が積み上がると、投資余力が消え、成長が止まります。         |
| D        | 意思決定の遅れは、ガバナンスリスクとして後から大きなコストになります。     |

---

### 4. CTAセクション

優先カテゴリに応じたリードテキストとダウンロードボタンを表示。

| カテゴリ | ボタンテキスト                                       |
| -------- | ---------------------------------------------------- |
| A        | 生成AI時代の「次世代」工数管理ガイドラインを受け取る |
| B        | 生成AI時代の「脱・属人化」のロードマップを受け取る   |
| C        | 生成AI時代対応版「収益管理」ガイドラインを受け取る   |
| D        | 生成AI時代の「経営管理変革」ロードマップを受け取る   |

ボタン押下でメール送信ダイアログを開く。メール送信時に優先カテゴリに対応する白書PDFが添付される。

---

### 5. チャート（2カラム横並び）

#### 5-1. 散布図（ポートフォリオ分析）

- **X軸**: 成熟度（0〜3）
- **Y軸**: 重要度（0〜3）
- 各カテゴリの（平均成熟度, 平均重要度）を1点ずつプロット（計4点）
- 左上エリア（成熟度 0〜1.5, 重要度 1.5〜3）に赤い半透明の背景（**優先改善ゾーン**）
- カテゴリ別の色: A=青, B=緑, C=アンバー, D=紫

#### 5-2. レーダーチャート（成熟度比較）

- 4軸: 稼働管理 / スキル・配員 / 収益性管理 / プロセス成熟度
- **青色の実線**: 現状の平均成熟度
- **グレーの破線**: 理想値（常に3.0）
- スケール: 0〜3

---

### 6. 詳細スコアテーブル

| 列           | 内容        | 計算方法                        |
| ------------ | ----------- | ------------------------------- |
| カテゴリー   | カテゴリ名  | —                               |
| 成熟度 (Avg) | `X.X / 3.0` | カテゴリ内3問の成熟度平均       |
| 重要度 (Avg) | `X.X / 3.0` | カテゴリ内3問の重要度平均       |
| リスクスコア | `X.X`       | `(3 - 平均成熟度) × 平均重要度` |
| 判定         | バッジ表示  | 下記ロジック                    |

#### 判定ロジック

| 判定     | 条件                                       | バッジ色                                |
| -------- | ------------------------------------------ | --------------------------------------- |
| **危険** | 平均成熟度 < 1.5 **かつ** 平均重要度 > 2.0 | 赤 (`text-red-600 bg-red-50`)           |
| **注意** | 平均成熟度 < 2.0（危険に該当しない場合）   | アンバー (`text-amber-600 bg-amber-50`) |
| **良好** | 平均成熟度 ≥ 2.0                           | 緑 (`text-green-600 bg-green-50`)       |

---

### 7. フッター

- プライバシー・ポリシーリンク（Canvaホスト）

---

## メール送信ダイアログ

| 項目           | 内容                                                   |
| -------------- | ------------------------------------------------------ |
| タイトル       | 診断レポートの転送                                     |
| 入力フィールド | メールアドレス（必須）                                 |
| 注意書き       | メールアドレスの利用目的（診断結果送付・サービス案内） |
| 送信ボタン     | 「メールを送信する」                                   |

送信データ（`POST /api/send-report`）:

- `email`, `name`, `assessmentId`, `resultUrl`
- `reportData`: ユーザー名、診断日、優先タイトル/テキスト、落とし穴、推奨アクション、優先カテゴリ、カテゴリ別スコア

---

## ソースファイル

- 結果画面: `client/src/pages/Result.tsx`
- スコアリング詳細: [scoring-logic.md](./scoring-logic.md)
